<?xml version="1.0" encoding="UTF-8"?>

<?import java.net.URL?>
<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<BorderPane fx:id="root"
            xmlns="http://javafx.com/javafx/17.0.12"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="sk.upjs.paz.ui.EndSessionController"
            styleClass="dashboard-root">

    <top>
        <VBox styleClass="session-end-header">
            <padding>
                <Insets top="20" right="24" bottom="16" left="24"/>
            </padding>
            <children>
                <HBox alignment="CENTER_LEFT" spacing="16.0">
                    <children>
                        <VBox spacing="4.0">
                            <children>
                                <Label text="End reading session" styleClass="session-end-title"/>
                                <Label text="Review your reading and save this session."
                                       wrapText="true"
                                       styleClass="session-end-subtitle"/>
                            </children>
                        </VBox>

                        <Pane HBox.hgrow="ALWAYS"/>

                        <Button text="Discard"
                                onAction="#handleDiscard"
                                styleClass="session-end-discard-button"/>
                    </children>
                </HBox>
            </children>
        </VBox>
    </top>

    <center>
        <!-- CHANGED: make center scrollable for small window heights -->
        <ScrollPane fx:id="contentScrollPane"
                    fitToWidth="true"
                    hbarPolicy="NEVER">
            <content>
                <VBox spacing="16.0">
                    <padding>
                        <Insets top="0" right="24" bottom="16" left="24"/>
                    </padding>
                    <children>

                        <HBox spacing="12.0"
                              alignment="CENTER_LEFT"
                              styleClass="session-end-book-card">
                            <children>

                                <StackPane prefWidth="48.0"
                                           prefHeight="72.0"
                                           styleClass="session-end-cover-placeholder">
                                    <children>
                                        <ImageView fx:id="coverImageView"
                                                   fitWidth="48.0"
                                                   fitHeight="72.0"
                                                   preserveRatio="false"/>
                                    </children>
                                </StackPane>

                                <VBox spacing="4.0">
                                    <children>
                                        <Label fx:id="bookTitleLabel"
                                               text="Book title"
                                               styleClass="session-end-book-title"/>
                                        <Label fx:id="bookMetaLabel"
                                               text="Author Â· Genre"
                                               styleClass="session-end-book-meta"/>

                                        <HBox spacing="8.0">
                                            <children>
                                                <Label fx:id="statusPill"
                                                       text="READING"
                                                       styleClass="session-status-pill"/>
                                                <Label fx:id="currentPageLabel"
                                                       text="Current page: 0"
                                                       styleClass="session-end-book-meta"/>
                                            </children>
                                        </HBox>
                                    </children>
                                </VBox>
                            </children>
                        </HBox>

                        <!-- Single-column layout -->
                        <VBox spacing="20.0">

                            <!-- Session time -->
                            <VBox spacing="8.0">
                                <children>
                                    <Label text="Session time" styleClass="session-end-section-title"/>

                                    <HBox spacing="12.0">
                                        <children>
                                            <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                                <children>
                                                    <Label text="Start time" styleClass="session-end-field-label"/>
                                                    <TextField fx:id="startTimeField"
                                                               maxWidth="Infinity"
                                                               promptText="2025-12-18 00:43"
                                                               styleClass="text-field"/>
                                                </children>
                                            </VBox>

                                            <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                                <children>
                                                    <Label text="Duration (min)" styleClass="session-end-field-label"/>
                                                    <TextField fx:id="durationField"
                                                               maxWidth="Infinity"
                                                               promptText="32"
                                                               styleClass="text-field"/>
                                                </children>
                                            </VBox>
                                        </children>
                                    </HBox>

                                    <Label text="You can adjust the duration if needed."
                                           styleClass="session-end-helper-text"/>
                                </children>
                            </VBox>

                            <!-- Pages -->
                            <VBox spacing="8.0">
                                <children>
                                    <Label text="Pages" styleClass="session-end-section-title"/>

                                    <HBox spacing="12.0">
                                        <children>
                                            <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                                <children>
                                                    <Label text="Start page" styleClass="session-end-field-label"/>
                                                    <TextField fx:id="startPageField"
                                                               maxWidth="Infinity"
                                                               promptText="164"
                                                               styleClass="text-field"/>
                                                </children>
                                            </VBox>

                                            <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                                <children>
                                                    <Label text="End page" styleClass="session-end-field-label"/>
                                                    <TextField fx:id="endPageField"
                                                               maxWidth="Infinity"
                                                               promptText="188"
                                                               styleClass="text-field"/>
                                                </children>
                                            </VBox>
                                        </children>
                                    </HBox>

                                    <HBox spacing="8.0" alignment="CENTER_LEFT">
                                        <children>
                                            <Label text="Pages read: " styleClass="session-end-helper-text"/>
                                            <Label fx:id="pagesReadLabel"
                                                   text="0"
                                                   styleClass="session-end-pages-pill"/>
                                        </children>
                                    </HBox>

                                    <Label text="We will calculate pages read from these values."
                                           styleClass="session-end-helper-text"/>
                                </children>
                            </VBox>

                        </VBox>

                    </children>
                </VBox>
            </content>
        </ScrollPane>
    </center>

    <bottom>
        <HBox alignment="CENTER_LEFT" spacing="12.0">
            <padding>
                <Insets top="12" right="24" bottom="16" left="24"/>
            </padding>
            <children>
                <Label text="You can edit this session later in Statistics."
                       wrapText="true"
                       styleClass="session-end-helper-text"/>

                <Pane HBox.hgrow="ALWAYS"/>

                <Button text="Cancel"
                        onAction="#handleCancel"
                        styleClass="session-end-cancel-button"/>

                <Button text="Save session"
                        onAction="#handleSave"
                        styleClass="header-primary-button"/>
            </children>
        </HBox>
    </bottom>

</BorderPane>
