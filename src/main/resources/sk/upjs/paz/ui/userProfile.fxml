<?xml version="1.0" encoding="UTF-8"?>

<?import java.net.URL?>
<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import java.lang.String?>

<BorderPane fx:id="root"
            xmlns="http://javafx.com/javafx/17.0.12"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="sk.upjs.paz.ui.UserProfileController"
            styleClass="dashboard-root">

    <!-- ===== SIDEBAR ===== -->
    <left>
        <VBox prefWidth="240.0"
              styleClass="sidebar">
            <children>

                <HBox styleClass="sidebar-header" spacing="10.0" alignment="CENTER_LEFT">
                    <children>
                        <StackPane prefWidth="34.0" prefHeight="34.0" styleClass="sidebar-logo-circle">
                            <children>
                                <Label text="" styleClass="sidebar-logo-letter"/>
                            </children>
                        </StackPane>
                        <Label text="%app.name" styleClass="sidebar-logo-text"/>
                    </children>
                </HBox>

                <VBox styleClass="sidebar-nav">
                    <children>
                        <ToggleButton fx:id="dashboardNavButton"
                                      text="%nav.dashboard"
                                      onAction="#onDashboardSelected"
                                      styleClass="sidebar-nav-button"/>

                        <ToggleButton fx:id="libraryNavButton"
                                      text="%nav.library"
                                      onAction="#onLibrarySelected"
                                      styleClass="sidebar-nav-button"/>

                        <ToggleButton fx:id="currentlyReadingNavButton"
                                      text="%nav.currentlyReading"
                                      onAction="#onCurrentlyReadingSelected"
                                      styleClass="sidebar-nav-button"/>

                        <ToggleButton fx:id="statisticsNavButton"
                                      text="%nav.statistics"
                                      onAction="#onStatisticsSelected"
                                      styleClass="sidebar-nav-button"/>
                    </children>
                </VBox>

                <Pane VBox.vgrow="ALWAYS"/>

                <VBox styleClass="sidebar-user">
                    <children>
                        <Button fx:id="userProfileButton"
                                onAction="#onUserProfile"
                                styleClass="sidebar-user-button"
                                maxWidth="Infinity">
                            <graphic>
                                <HBox spacing="10.0" alignment="CENTER_LEFT">
                                    <children>
                                        <StackPane prefWidth="34.0" prefHeight="34.0" styleClass="sidebar-user-avatar">
                                            <children>
                                                <Label fx:id="userInitialsLabel"
                                                       text=""
                                                       styleClass="sidebar-user-initials"/>
                                            </children>
                                        </StackPane>

                                        <VBox spacing="2.0">
                                            <children>
                                                <Label fx:id="userNameLabel"
                                                       text="%userProfile.user_name"
                                                       styleClass="sidebar-user-name"/>
                                                <Label fx:id="userSubtitleLabel"
                                                       text="%nav.viewProfile"
                                                       styleClass="sidebar-user-subtitle"/>
                                            </children>
                                        </VBox>
                                    </children>
                                </HBox>
                            </graphic>
                        </Button>
                    </children>
                </VBox>

            </children>
        </VBox>
    </left>

    <!-- ===== HEADER ===== -->
    <top>
        <VBox styleClass="header">
            <children>
                <HBox styleClass="header-inner" alignment="CENTER_LEFT" spacing="16.0">
                    <padding>
                        <Insets top="18" right="24" bottom="18" left="24"/>
                    </padding>
                    <children>

                        <VBox spacing="4.0">
                            <children>
                                <Label fx:id="headerTitleLabel"
                                       text="%userProfile.profile"
                                       styleClass="header-title"/>
                                <Label fx:id="headerSubtitleLabel"
                                       text="%userProfile.header_subtitle"
                                       styleClass="header-subtitle"/>
                            </children>
                        </VBox>

                        <Pane HBox.hgrow="ALWAYS"/>

                        <!-- wrap-friendly actions -->
                        <FlowPane hgap="8.0" vgap="8.0" alignment="CENTER_RIGHT" prefWrapLength="240">
                            <children>
                                <Button fx:id="notificationsButton"
                                        onAction="#onNotifications"
                                        styleClass="header-icon-button">
                                    <graphic>
                                        <ImageView fx:id="notificationsIcon"
                                                   fitWidth="18" fitHeight="18"
                                                   pickOnBounds="true"/>
                                    </graphic>
                                </Button>

                                <ToggleButton fx:id="themeToggle"
                                              onAction="#onToggleTheme"
                                              styleClass="header-icon-button">
                                    <graphic>
                                        <ImageView fx:id="themeIcon" fitWidth="18" fitHeight="18" pickOnBounds="true"/>
                                    </graphic>
                                </ToggleButton>
                            </children>
                        </FlowPane>

                    </children>
                </HBox>
            </children>
        </VBox>
    </top>

    <!-- ===== CONTENT ===== -->
    <center>
        <ScrollPane fx:id="contentScrollPane"
                    fitToWidth="true"
                    hbarPolicy="NEVER"
                    VBox.vgrow="ALWAYS"
                    styleClass="scroll-pane">
            <content>
                <!-- CHANGED: center cards on big screens -->
                <StackPane>
                    <padding>
                        <Insets top="24" right="24" bottom="24" left="24"/>
                    </padding>

                    <children>
                        <VBox spacing="24.0" maxWidth="760.0">

                            <!-- PROFILE CARD -->
                            <VBox spacing="14.0" styleClass="stat-card">
                                <children>

                                    <Label text="%userProfile.profile" styleClass="section-title"/>

                                    <HBox spacing="12.0" alignment="CENTER_LEFT">
                                        <children>
                                            <StackPane prefWidth="54.0" prefHeight="54.0"
                                                       styleClass="settings-avatar-circle">
                                                <children>
                                                    <Label fx:id="profileAvatarText"
                                                           text=""
                                                           styleClass="settings-avatar-text"/>
                                                </children>
                                            </StackPane>

                                            <VBox spacing="4.0">
                                                <children>
                                                    <Label fx:id="profileNameLabel"
                                                           text=""
                                                           styleClass="settings-name"/>
                                                    <Label fx:id="profileMetaLabel"
                                                           text=""
                                                           styleClass="settings-helper"/>
                                                </children>
                                            </VBox>
                                        </children>
                                    </HBox>

                                    <VBox spacing="6.0">
                                        <children>
                                            <Label text="%common.email" styleClass="settings-small-label"/>
                                            <Label fx:id="emailValueLabel"
                                                   text=""
                                                   styleClass="settings-email-box"/>
                                        </children>
                                    </VBox>

                                    <Separator/>

                                    <VBox fx:id="editBox" spacing="10.0" visible="false" managed="false">
                                        <children>
                                            <VBox spacing="6.0">
                                                <children>
                                                    <Label text="%userProfile.name" styleClass="settings-small-label"/>
                                                    <TextField fx:id="nameEditField"
                                                               maxWidth="Infinity"
                                                               promptText="%userProfile.your_name"
                                                               styleClass="settings-number-field"/>
                                                </children>
                                            </VBox>

                                            <!-- wrap-friendly buttons -->
                                            <FlowPane hgap="10.0" vgap="10.0" alignment="CENTER_RIGHT">
                                                <children>
                                                    <Button fx:id="cancelEditButton"
                                                            text="%common.cancel"
                                                            onAction="#onCancelEdit"
                                                            styleClass="header-secondary-button"/>
                                                    <Button fx:id="saveProfileButton"
                                                            text="%common.save"
                                                            onAction="#onSaveProfile"
                                                            styleClass="header-primary-button"/>
                                                </children>
                                            </FlowPane>
                                        </children>
                                    </VBox>

                                    <VBox spacing="10.0">
                                        <children>
                                            <Label text="%userProfile.quick_actions" styleClass="settings-label"/>

                                            <!-- CHANGED: HBox -> FlowPane (wrap on narrow) -->
                                            <FlowPane hgap="10.0" vgap="10.0">
                                                <children>
                                                    <Button fx:id="editProfileButton"
                                                            text="%userProfile.edit_profile"
                                                            onAction="#onEditProfile"
                                                            styleClass="settings-secondary-button"/>
                                                    <Button fx:id="logoutButton"
                                                            text="%userProfile.log_out"
                                                            onAction="#onLogout"
                                                            styleClass="danger-text-button"/>
                                                </children>
                                            </FlowPane>
                                        </children>
                                    </VBox>

                                </children>
                            </VBox>

                            <!-- PREFERENCES -->
                            <VBox spacing="16.0" styleClass="stat-card">
                                <children>

                                    <Label text="%userProfile.section.preferences" styleClass="section-title"/>

                                    <VBox spacing="6.0">
                                        <children>
                                            <Label text="%settings.interface_language" styleClass="settings-label"/>
                                            <ComboBox fx:id="interfaceLanguageCombo"
                                                      maxWidth="Infinity"
                                                      styleClass="settings-combobox">
                                                <items>
                                                    <FXCollections fx:factory="observableArrayList">
                                                        <String fx:value="English"/>
                                                        <String fx:value="Slovak"/>
                                                    </FXCollections>
                                                </items>
                                            </ComboBox>

                                            <Label wrapText="true"
                                                   text="%settings.only_labels_and_messages_are_affected"
                                                   styleClass="settings-helper"/>
                                        </children>
                                    </VBox>

                                    <VBox spacing="6.0">
                                        <children>
                                            <Label text="%settings.theme" styleClass="settings-label"/>

                                            <!-- CHANGED: wrap-friendly segmented buttons -->
                                            <FlowPane hgap="8.0" vgap="8.0">
                                                <children>
                                                    <ToggleButton fx:id="themeLightToggle"
                                                                  text="%settings.light"
                                                                  onAction="#onThemeLight"
                                                                  styleClass="segmented-pill"/>

                                                    <ToggleButton fx:id="themeDarkToggle"
                                                                  text="%settings.dark"
                                                                  onAction="#onThemeDark"
                                                                  styleClass="segmented-pill"/>
                                                </children>
                                            </FlowPane>
                                        </children>
                                    </VBox>

                                </children>
                            </VBox>

                        </VBox>
                    </children>
                </StackPane>
            </content>
        </ScrollPane>
    </center>

</BorderPane>
