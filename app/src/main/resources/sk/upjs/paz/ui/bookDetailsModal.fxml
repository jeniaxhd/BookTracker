<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<BorderPane fx:id="root"
            xmlns="http://javafx.com/javafx/17.0.12"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="sk.upjs.paz.ui.BookDetailsModalController"
            styleClass="book-detail-root">

    <!-- ========= HEADER ========= -->
    <top>
        <VBox styleClass="book-detail-header">
            <children>
                <HBox alignment="CENTER_LEFT" spacing="16.0">
                    <padding>
                        <Insets top="20" right="24" bottom="16" left="24"/>
                    </padding>
                    <children>

                        <VBox spacing="4.0">
                            <children>
                                <Label fx:id="titleLabel"
                                       styleClass="header-title"/>
                                <Label fx:id="subtitleLabel"
                                       styleClass="header-subtitle"
                                       text="%bookDetailsModal.book_details_and_metadata"/>
                            </children>
                        </VBox>

                        <Pane HBox.hgrow="ALWAYS"/>

                        <!-- hidden actions -->
                        <HBox alignment="CENTER_RIGHT"
                              spacing="10.0"
                              visible="false"
                              managed="false">
                            <children>
                                <Button fx:id="startSessionHeaderButton"
                                        minWidth="180.0"
                                        mnemonicParsing="false"
                                        onAction="#handleStartSession"
                                        styleClass="header-primary-button"
                                        text="%bookDetailsModal.start_reading_session"/>
                                <Button fx:id="closeIconButton"
                                        minWidth="36.0"
                                        onAction="#handleClose"
                                        styleClass="header-icon-button"
                                        text="✕"/>
                            </children>
                        </HBox>

                    </children>
                </HBox>

                <Separator/>
            </children>
        </VBox>
    </top>

    <!-- ========= MAIN CONTENT ========= -->
    <center>
        <!-- CHANGED: add ScrollPane so height resize never breaks layout -->
        <ScrollPane fx:id="contentScrollPane"
                    fitToWidth="true"
                    hbarPolicy="NEVER">
            <content>
                <VBox spacing="24.0">
                    <padding>
                        <Insets top="24" right="32" bottom="24" left="32"/>
                    </padding>

                    <!-- CHANGED: HBox -> FlowPane so 2 columns wrap into 1 column on narrow width -->
                    <FlowPane fx:id="mainFlow"
                              hgap="32.0"
                              vgap="24.0">

                        <!-- LEFT COLUMN: cover + quick meta -->
                        <VBox prefWidth="260.0"
                              minWidth="240.0"
                              spacing="16.0">

                            <StackPane prefHeight="320.0"
                                       prefWidth="220.0"
                                       styleClass="book-detail-cover">
                                <children>
                                    <ImageView fx:id="coverImageView"
                                               fitWidth="220.0"
                                               fitHeight="320.0"
                                               preserveRatio="false"/>
                                    <Label fx:id="coverPlaceholderLabel"
                                           styleClass="book-detail-cover-placeholder"
                                           text="%bookDetailsModal.book_cover"/>
                                </children>
                            </StackPane>

                            <FlowPane hgap="12.0" vgap="8.0">
                                <children>

                                    <VBox alignment="CENTER"
                                          prefWidth="70.0"
                                          spacing="4.0"
                                          styleClass="book-meta-card">
                                        <children>
                                            <Label styleClass="book-meta-label" text="%common.year"/>
                                            <Label fx:id="yearLabel"
                                                   styleClass="book-meta-value"
                                                   text="—"/>
                                        </children>
                                    </VBox>

                                    <VBox alignment="CENTER"
                                          prefWidth="80.0"
                                          spacing="4.0"
                                          styleClass="book-meta-card">
                                        <children>
                                            <Label styleClass="book-meta-label" text="%common.pages"/>
                                            <Label fx:id="pagesLabel"
                                                   styleClass="book-meta-value"
                                                   text="—"/>
                                        </children>
                                    </VBox>

                                </children>
                            </FlowPane>

                            <HBox spacing="8.0">
                                <children>
                                    <Label fx:id="genreLabel"
                                           styleClass="tag-pill"
                                           text="—"/>
                                    <Label fx:id="statusLabel"
                                           styleClass="status-pill--in-progress"
                                           text="—"/>
                                </children>
                            </HBox>

                        </VBox>

                        <!-- RIGHT COLUMN: details -->
                        <VBox prefWidth="520.0"
                              minWidth="320.0"
                              spacing="20.0">

                            <VBox spacing="6.0">
                                <children>
                                    <Label fx:id="bookTitleBigLabel"
                                           styleClass="book-title-big"/>
                                    <HBox spacing="8.0" alignment="CENTER_LEFT">
                                        <children>
                                            <Label text="by" styleClass="muted"/>
                                            <Label fx:id="bookAuthorBigLabel"
                                                   styleClass="book-author-big"/>
                                        </children>
                                    </HBox>
                                </children>
                            </VBox>

                            <Separator/>

                            <VBox spacing="8.0">
                                <children>
                                    <Label styleClass="section-title"
                                           text="%bookDetailsModal.about_this_book"/>

                                    <!-- CHANGED: allow it to adapt -->
                                    <Label fx:id="descriptionLabel"
                                           maxWidth="Infinity"
                                           styleClass="book-detail-body-text"
                                           text=""
                                           wrapText="true"/>
                                </children>
                            </VBox>

                            <VBox spacing="10.0">
                                <children>
                                    <Label styleClass="section-title" text="Your review"/>

                                    <TextArea fx:id="reviewArea"
                                              promptText="Write a short review..."
                                              prefRowCount="5"
                                              wrapText="true"
                                              styleClass="text-area"
                                              maxWidth="Infinity"/>

                                    <HBox alignment="CENTER_RIGHT">
                                        <children>
                                            <Button fx:id="saveReviewButton"
                                                    text="Save review"
                                                    mnemonicParsing="false"
                                                    onAction="#handleSaveReview"
                                                    styleClass="header-secondary-button"/>
                                        </children>
                                    </HBox>
                                </children>
                            </VBox>

                        </VBox>

                    </FlowPane>
                </VBox>
            </content>
        </ScrollPane>
    </center>

    <!-- ========= FOOTER ========= -->
    <bottom>
        <VBox>
            <children>
                <Separator/>
                <HBox alignment="CENTER_LEFT" spacing="12.0">
                    <padding>
                        <Insets top="12" right="24" bottom="16" left="24"/>
                    </padding>
                    <children>

                        <Label styleClass="stat-subtitle"
                               wrapText="true"
                               text="%bookDetailsModal.you_can_edit_this_information_later_from_your_libr"/>

                        <Pane HBox.hgrow="ALWAYS"/>

                        <Button fx:id="closeButton"
                                text="%common.close"
                                mnemonicParsing="false"
                                onAction="#handleClose"
                                styleClass="header-secondary-button"/>

                        <Button fx:id="startSessionFooterButton"
                                minWidth="190.0"
                                mnemonicParsing="false"
                                onAction="#handleStartSession"
                                styleClass="header-primary-button"
                                text="%bookDetailsModal.start_reading_session"/>

                    </children>
                </HBox>
            </children>
        </VBox>
    </bottom>

</BorderPane>
